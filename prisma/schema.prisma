datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id            Int       @id @default(autoincrement())
  name          String
  email         String    @unique
  password      String
  referralCode  String    @unique @default(uuid())
  // Relationship: Who referred this user
  referredBy    User?     @relation("Referral", fields: [referredById], references: [id])
  referredById  Int?
  // Relationship: Users referred by this user
  referredUsers User[]    @relation("Referral")
  orders        Order[]   // A user can place multiple orders
  commissions   Commission[] // A user can earn multiple commissions
}

model Order {
  id          Int        @id @default(autoincrement())
  // Relationship: User who placed the odr
  user        User       @relation(fields: [userId], references: [id])
  userId      Int
  amount      Float
  createdAt   DateTime   @default(now())
  commissions Commission[] // Commissions linked to this oder

}
model Commission {
  id             Int       @id @default(autoincrement())
  // Relationship: Order associated with the commission
  order          Order     @relation(fields: [orderId], references: [id])
  orderId        Int
  // Relationship: User who earned the commission
  referrer       User      @relation(fields: [referrerId], references: [id])
  referrerId     Int
  commissionAmount Float
  level          Int       // Referral level (e.g., 1st level, 2nd level)
  createdAt      DateTime  @default(now())

  @@index([orderId])
  @@index([referrerId])
}


